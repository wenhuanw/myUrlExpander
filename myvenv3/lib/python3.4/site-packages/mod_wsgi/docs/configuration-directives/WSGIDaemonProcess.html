

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>WSGIDaemonProcess &mdash; mod_wsgi 4.5.3 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="mod_wsgi 4.5.3 documentation" href="../index.html"/>
        <link rel="up" title="Configuration" href="../configuration.html"/>
        <link rel="next" title="WSGIImportScript" href="WSGIImportScript.html"/>
        <link rel="prev" title="WSGICaseSensitivity" href="WSGICaseSensitivity.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> mod_wsgi
          

          
          </a>

          
            
            
              <div class="version">
                4.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../project-status.html">Project Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security-issues.html">Security Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guides.html">User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="WSGIAcceptMutex.html">WSGIAcceptMutex</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIAccessScript.html">WSGIAccessScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIApplicationGroup.html">WSGIApplicationGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIAuthGroupScript.html">WSGIAuthGroupScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIAuthUserScript.html">WSGIAuthUserScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGICallableObject.html">WSGICallableObject</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGICaseSensitivity.html">WSGICaseSensitivity</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">WSGIDaemonProcess</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIImportScript.html">WSGIImportScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGILazyInitialization.html">WSGILazyInitialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIPassAuthorization.html">WSGIPassAuthorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIProcessGroup.html">WSGIProcessGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIPythonEggs.html">WSGIPythonEggs</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIPythonHome.html">WSGIPythonHome</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIPythonOptimize.html">WSGIPythonOptimize</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIPythonPath.html">WSGIPythonPath</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIRestrictEmbedded.html">WSGIRestrictEmbedded</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIRestrictProcess.html">WSGIRestrictProcess</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIRestrictSignal.html">WSGIRestrictSignal</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIRestrictStdin.html">WSGIRestrictStdin</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIRestrictStdout.html">WSGIRestrictStdout</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIScriptAlias.html">WSGIScriptAlias</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIScriptAliasMatch.html">WSGIScriptAliasMatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGIScriptReloading.html">WSGIScriptReloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="WSGISocketPrefix.html">WSGISocketPrefix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../finding-help.html">Finding Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporting-bugs.html">Reporting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source-code.html">Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">mod_wsgi</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../configuration.html">Configuration</a> &raquo;</li>
      
    <li>WSGIDaemonProcess</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/configuration-directives/WSGIDaemonProcess.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="wsgidaemonprocess">
<h1>WSGIDaemonProcess<a class="headerlink" href="#wsgidaemonprocess" title="Permalink to this headline">Â¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Description:</th><td class="field-body">Configure a distinct daemon process for running applications.</td>
</tr>
<tr class="field-even field"><th class="field-name">Syntax:</th><td class="field-body"><code class="docutils literal"><span class="pre">WSGIDaemonProcess</span></code> <em>name</em> <code class="docutils literal"><span class="pre">[</span></code> <em>options</em> <code class="docutils literal"><span class="pre">]</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Context:</th><td class="field-body">server config, virtual host</td>
</tr>
</tbody>
</table>
<p>The WSGIDaemonProcess directive can be used to specify that distinct daemon
processes should be created to which the running of WSGI applications can
be delegated. Where Apache has been started as the <code class="docutils literal"><span class="pre">root</span></code> user, the
daemon processes can be run as a user different to that which the Apache
child processes would normally be run as.</p>
<p>When distinct daemon processes are enabled and used, the process is
dedicated to mod_wsgi and the only thing that the processes do is run the
WSGI applications assigned to that process group. Any other Apache modules
such as PHP or activities such as serving up static files continue to be
run in the standard Apache child processes.</p>
<p>Note that having denoted that daemon processes should be created by using
the WSGIDaemonProcess directive, the WSGIProcessGroup directive still needs
to be used to delegate specific WSGI applications to execute within those
daemon processes.</p>
<p>Also note that the name of the daemon process group must be unique for the
whole server. That is, it is not possible to use the same daemon process
group name in different virtual hosts.</p>
<p>Options which can be supplied to the WSGIDaemonProcess directive are:</p>
<dl class="docutils">
<dt><strong>user=name | user=#uid</strong>.rst</dt>
<dd><p class="first">Defines the UNIX user <em>name</em> or numeric user <em>uid</em> of the user that
the daemon processes should be run as. If this option is not supplied
the daemon processes will be run as the same user that Apache would
run child processes and as defined by the <a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/mpm_common.html#user">User</a> directive.</p>
<p>Note that this option is ignored if Apache wasn&#8217;t started as the root
user, in which case no matter what the settings, the daemon processes
will be run as the user that Apache was started as.</p>
<blockquote class="last">
<div>Also be aware that mod_wsgi will not allow you to run a daemon
process group as the root user due to the security risk of running
a web application as root.</div></blockquote>
</dd>
<dt><strong>group=name | group=#gid</strong></dt>
<dd><p class="first">Defines the UNIX group <em>name</em> or numeric group <em>gid</em> of the primary
group that the daemon processes should be run as. If this option is not
supplied the daemon processes will be run as the same group that Apache
would run child processes and as defined by the <a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/mpm_common.html#group">Group</a> directive.</p>
<p class="last">Note that this option is ignored if Apache wasn&#8217;t started as the root
user, in which case no matter what the settings, the daemon processes
will be run as the group that Apache was started as.</p>
</dd>
<dt><strong>processes=num</strong></dt>
<dd><p class="first">Defines the number of daemon processes that should be started in this
process group. If not defined then only one process will be run in this
process group.</p>
<p class="last">Note that if this option is defined as &#8216;processes=1&#8217;, then the WSGI
environment attribute called &#8216;wsgi.multiprocess&#8217; will be set to be True
whereas not providing the option at all will result in the attribute
being set to be False. This distinction is to allow for where some form
of mapping mechanism might be used to distribute requests across
multiple process groups and thus in effect it is still a multiprocess
application. If you need to ensure that &#8216;wsgi.multiprocess&#8217; is False so
that interactive debuggers will work, simply do not specify the
&#8216;processes&#8217; option and allow the default single daemon process to be
created in the process group.</p>
</dd>
<dt><strong>threads=num</strong></dt>
<dd><p class="first">Defines the number of threads to be created to handle requests in each
daemon process within the process group.</p>
<p class="last">If this option is not defined then the default will be to create 15
threads in each daemon process within the process group.</p>
</dd>
<dt><strong>umask=0nnn</strong></dt>
<dd><p class="first">Defines a value to be used for the umask of the daemon processes within
the process group. The value must be provided as an octal number.</p>
<p class="last">If this option is not defined then the umask of the user that Apache is
initially started as will be inherited by the process. Typically the
inherited umask would be &#8216;0022&#8217;.</p>
</dd>
<dt><strong>home=directory</strong></dt>
<dd><p class="first">Defines an absolute path of a directory which should be used as the
initial current working directory of the daemon processes within the
process group.</p>
<p class="last">If this option is not defined, in mod_wsgi 1.X the current working
directory of the Apache parent process will be inherited by the daemon
processes within the process group. Normally the current working directory
of the Apache parent process would be the root directory. In mod_wsgi 2.0+
the initial current working directory will be set to be the home
directory of the user that the daemon process runs as.</p>
</dd>
<dt><strong>python-path=directory | python-path=directory:directory</strong></dt>
<dd><p class="first">List of colon separated directories to add to the Python module search
path, ie., <code class="docutils literal"><span class="pre">sys.path</span></code>.</p>
<p class="last">Note that this is not strictly the same as having set <code class="docutils literal"><span class="pre">PYTHONPATH</span></code>
environment variable when running normal command line Python. When this
option is used, the directories are added by calling
<code class="docutils literal"><span class="pre">site.addsitedir()</span></code>. As well as adding the directory to
<code class="docutils literal"><span class="pre">sys.path</span></code> this function has the effect of opening and interpreting
any &#8216;.pth&#8217; files located in the specified directories. The option
therefore can be used to point at the <code class="docutils literal"><span class="pre">site-packages</span></code> directory
corresponding to a Python virtual environment created by a tool such as
<code class="docutils literal"><span class="pre">virtualenv</span></code>, with any additional directories corresponding to
Python eggs within that directory also being automatically added to
<code class="docutils literal"><span class="pre">sys.path</span></code>.</p>
</dd>
<dt><strong>python-eggs=directory</strong></dt>
<dd><p class="first">Directory to be used as the Python egg cache directory. This is
equivalent to having set the <code class="docutils literal"><span class="pre">PYTHON_EGG_CACHE</span></code> environment
variable.</p>
<p class="last">Note that the directory specified must exist and be writable by the
user that the daemon process run as.</p>
</dd>
<dt><strong>stack-size=nnn</strong></dt>
<dd><p class="first">The amount of virtual memory in bytes to be allocated for the stack
corresponding to each thread created by mod_wsgi in a daemon process.</p>
<p class="last">This option would be used when running Linux in a VPS system which has
been configured with a quite low &#8216;Memory Limit&#8217; in relation to the
&#8216;Context RSS&#8217; and &#8216;Max RSS Memory&#8217; limits. In particular, the default
stack size for threads under Linux is 8MB is quite excessive and could
for such a VPS result in the &#8216;Memory Limit&#8217; being exceeded before the
RSS limits were exceeded. In this situation, the stack size should be
dropped down to be in the region of 512KB (524288 bytes).</p>
</dd>
<dt><strong>maximum-requests=nnn</strong></dt>
<dd><p class="first">Defines a limit on the number of requests a daemon process should
process before it is shutdown and restarted. Setting this to a non zero
value has the benefit of limiting the amount of memory that a process
can consume by (accidental) memory leakage.</p>
<p class="last">If this option is not defined, or is defined to be 0, then the daemon
process will be persistent and will continue to service requests until
Apache itself is restarted or shutdown.</p>
</dd>
<dt><strong>inactivity-timeout=sss</strong></dt>
<dd><p class="first">Defines the maximum number of seconds allowed to pass before the
daemon process is shutdown and restarted when the daemon process has
entered an idle state. For the purposes of this option, being idle
means no new requests being received, or no attempts by current
requests to read request content or generate response content for the
defined period.</p>
<p class="last">This option exists to allow infrequently used applications running in
a daemon process to be restarted, thus allowing memory being used to
be reclaimed, with process size dropping back to the initial startup
size before any application had been loaded or requests processed.</p>
</dd>
<dt><strong>deadlock-timeout=sss</strong></dt>
<dd><p class="first">Defines the maximum number of seconds allowed to pass before the
daemon process is shutdown and restarted after a potential deadlock on
the Python GIL has been detected. The default is 300 seconds.</p>
<p class="last">This option exists to combat the problem of a daemon process freezing
as the result of a rouge Python C extension module which doesn&#8217;t
properly release the Python GIL when entering into a blocking or long
running operation.</p>
</dd>
<dt><strong>shutdown-timeout=sss</strong></dt>
<dd><p class="first">Defines the maximum number of seconds allowed to pass when waiting
for a daemon process to gracefully shutdown as a result of the maximum
number of requests or inactivity timeout being reached, or when a user
initiated SIGINT signal is sent to a daemon process. When this timeout
has been reached the daemon process will be forced to exited even if
there are still active requests or it is still running Python exit
functions.</p>
<p class="last">If this option is not defined, then the shutdown timeout will be set
to 5 seconds. Note that this option does not change the shutdown
timeout applied to daemon processes when Apache itself is being stopped
or restarted. That timeout value is defined internally to Apache as 3
seconds and cannot be overridden.</p>
</dd>
<dt><strong>display-name=value</strong></dt>
<dd><p class="first">Defines a different name to show for the daemon process when using the
&#8216;ps&#8217; command to list processes. If the value is &#8216;%{GROUP}&#8217; then the
name will be &#8216;(wsgi:group)&#8217; where &#8216;group&#8217; is replaced with the name
of the daemon process group.</p>
<p>Note that only as many characters of the supplied value can be displayed
as were originally taken up by &#8216;argv0&#8217; of the executing process. Anything
in excess of this will be truncated.</p>
<p class="last">This feature may not work as described on all platforms. Typically it
also requires a &#8216;ps&#8217; program with BSD heritage. Thus on Solaris UNIX
the &#8216;/usr/bin/ps&#8217; program doesn&#8217;t work, but &#8216;/usr/ucb/ps&#8217; does.</p>
</dd>
<dt><strong>receive-buffer-size=nnn</strong></dt>
<dd><p class="first">Defines the UNIX socket buffer size for data being received by the
daemon process from the Apache child process.</p>
<p>This option may need to be used to override small default values set by
certain operating systems and would help avoid possibility of deadlock
between Apache child process and daemon process when WSGI application
generates large responses but doesn&#8217;t consume request content. In
general such deadlock problems would not arise with well behaved WSGI
applications, but some spam bots attempting to post data to web sites
are known to trigger the problem.</p>
<p class="last">The maximum possible value that can be set for the buffer size is
operating system dependent and will need to be calculated through trial
and error.</p>
</dd>
<dt><strong>send-buffer-size=nnn</strong></dt>
<dd><p class="first">Defines the UNIX socket buffer size for data being sent in the
direction daemon process back to Apache child process.</p>
<p>This option may need to be used to override small default values set by
certain operating systems and would help avoid possibility of deadlock
between Apache child process and daemon process when WSGI application
generates large responses but doesn&#8217;t consume request content. In
general such deadlock problems would not arise with well behaved WSGI
applications, but some spam bots attempting to post data to web sites
are known to trigger the problem.</p>
<p class="last">The maximum possible value that can be set for the buffer size is
operating system dependent and will need to be calculated through trial
and error.</p>
</dd>
</dl>
<p>To delegate a particular WSGI application to run in a named set of daemon
processes, the WSGIProcessGroup directive should be specified in
appropriate context for that application. If WSGIProcessGroup is not used,
the application will be run within the standard Apache child processes.</p>
<p>If the WSGIDaemonProcess directive is specified outside of all virtual
host containers, any WSGI application can be delegated to be run within
that daemon process group. If the WSGIDaemonProcess directive is specified
within a virtual host container, only WSGI applications associated with
virtual hosts with the same server name as that virtual host can be
delegated to that set of daemon processes.</p>
<p>When WSGIDaemonProcess is associated with a virtual host, the error log
associated with that virtual host will be used for all Apache error log
output from mod_wsgi rather than it appear in the main Apache error log.</p>
<p>For example, if a server is hosting two virtual hosts and it is desired
that the WSGI applications related to each virtual host run in distinct
processes of their own and as a user which is the owner of that virtual
host, the following could be used:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;VirtualHost *:80&gt;
ServerName www.site1.com
CustomLog logs/www.site1.com-access_log common
ErrorLog logs/ww.site1.com-error_log

WSGIDaemonProcess www.site1.com user=joe group=joe processes=2 threads=25
WSGIProcessGroup www.site1.com

...
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
ServerName www.site2.com
CustomLog logs/www.site2.com-access_log common
ErrorLog logs/www.site2.com-error_log

WSGIDaemonProcess www.site2.com user=bob group=bob processes=2 threads=25
WSGIProcessGroup www.site2.com

...
&lt;/VirtualHost&gt;
</pre></div>
</div>
<p>Note that the WSGIDaemonProcess directive and corresponding features are
not available on Windows or when running Apache 1.3.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="WSGIImportScript.html" class="btn btn-neutral float-right" title="WSGIImportScript" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="WSGICaseSensitivity.html" class="btn btn-neutral" title="WSGICaseSensitivity" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2007-2016, Graham Dumpleton.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'4.5.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>